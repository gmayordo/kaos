openapi: 3.0.3
info:
  title: KAOS API
  description: API de la Plataforma de Gestión de Equipos de Desarrollo
  version: 1.0.0
  contact:
    name: Equipo KAOS
    email: kaos@ehcos.com

servers:
  - url: http://localhost:8080
    description: Desarrollo local

tags:
  - name: PerfilHorario
    description: Gestión de perfiles de horario laboral
  - name: Squad
    description: Gestión de equipos de desarrollo (squads)
  - name: Persona
    description: Gestión de miembros del equipo
  - name: SquadMember
    description: Gestión de asignaciones persona-squad (dedicación)
  - name: Festivo
    description: Gestión de festivos con asignación a personas
  - name: Vacacion
    description: Gestión de vacaciones por persona
  - name: Ausencia
    description: Gestión de ausencias por persona
  - name: Capacidad
    description: Cálculo de capacidad disponible por persona y squad

paths:
  # ═══════════════════════════════════════════════
  # PERFILES DE HORARIO
  # ═══════════════════════════════════════════════
  /api/v1/perfiles-horario:
    get:
      operationId: listarPerfilesHorario
      summary: Lista todos los perfiles de horario
      description: Devuelve todos los perfiles de horario configurados en el sistema.
      tags: [PerfilHorario]
      responses:
        "200":
          description: Lista de perfiles de horario
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/PerfilHorarioResponse"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      operationId: crearPerfilHorario
      summary: Crea un nuevo perfil de horario
      tags: [PerfilHorario]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PerfilHorarioRequest"
            example:
              nombre: "España"
              zonaHoraria: "Europe/Madrid"
              horasLunes: 8.5
              horasMartes: 8.5
              horasMiercoles: 8.5
              horasJueves: 8.5
              horasViernes: 7.0
      responses:
        "201":
          description: Perfil de horario creado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PerfilHorarioResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/perfiles-horario/{id}:
    get:
      operationId: obtenerPerfilHorario
      summary: Obtiene un perfil de horario por ID
      tags: [PerfilHorario]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Perfil de horario encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PerfilHorarioResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      operationId: actualizarPerfilHorario
      summary: Actualiza un perfil de horario
      tags: [PerfilHorario]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PerfilHorarioRequest"
      responses:
        "200":
          description: Perfil de horario actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PerfilHorarioResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      operationId: eliminarPerfilHorario
      summary: Elimina un perfil de horario
      description: Solo se puede eliminar si no tiene personas asignadas.
      tags: [PerfilHorario]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "204":
          description: Perfil de horario eliminado
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

  # ═══════════════════════════════════════════════
  # SQUADS
  # ═══════════════════════════════════════════════
  /api/v1/squads:
    get:
      operationId: listarSquads
      summary: Lista squads con filtro opcional por estado
      tags: [Squad]
      parameters:
        - name: estado
          in: query
          required: false
          schema:
            type: string
            enum: [ACTIVO, INACTIVO]
          description: Filtrar por estado del squad
      responses:
        "200":
          description: Lista de squads
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SquadResponse"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      operationId: crearSquad
      summary: Crea un nuevo squad
      tags: [Squad]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SquadRequest"
            example:
              nombre: "red"
              descripcion: "Squad Red — Correctivos y evolutivos"
              idSquadCorrJira: "CORR-RED"
              idSquadEvolJira: "EVOL-RED"
      responses:
        "201":
          description: Squad creado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SquadResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/squads/{id}:
    get:
      operationId: obtenerSquad
      summary: Obtiene un squad por ID
      tags: [Squad]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Squad encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SquadResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      operationId: actualizarSquad
      summary: Actualiza un squad
      tags: [Squad]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SquadRequest"
      responses:
        "200":
          description: Squad actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SquadResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/squads/{id}/desactivar:
    patch:
      operationId: desactivarSquad
      summary: Desactiva un squad (soft delete)
      description: Cambia el estado del squad a INACTIVO. No se permite si tiene sprints activos.
      tags: [Squad]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Squad desactivado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SquadResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

  # ═══════════════════════════════════════════════
  # PERSONAS
  # ═══════════════════════════════════════════════
  /api/v1/personas:
    get:
      operationId: listarPersonas
      summary: Lista personas con paginación y filtros
      description: Devuelve lista paginada de personas. Filtrable por squad, rol, seniority, ubicación y estado.
      tags: [Persona]
      parameters:
        - $ref: "#/components/parameters/PageParam"
        - $ref: "#/components/parameters/SizeParam"
        - $ref: "#/components/parameters/SortParam"
        - name: squadId
          in: query
          required: false
          schema:
            type: integer
            format: int64
          description: Filtrar por squad (ID)
        - name: rol
          in: query
          required: false
          schema:
            type: string
            enum:
              [
                LIDER_TECNICO,
                LIDER_FUNCIONAL,
                FRONTEND,
                BACKEND,
                QA,
                SCRUM_MASTER,
              ]
          description: Filtrar por rol en squad
        - name: seniority
          in: query
          required: false
          schema:
            type: string
            enum: [JUNIOR, MID, SENIOR, LEAD]
          description: Filtrar por seniority
        - name: ubicacion
          in: query
          required: false
          schema:
            type: string
          description: Filtrar por zona horaria (parcial, ej. 'Madrid')
        - name: activo
          in: query
          required: false
          schema:
            type: boolean
          description: Filtrar por estado activo/inactivo
      responses:
        "200":
          description: Página de personas
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PagePersonaResponse"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      operationId: crearPersona
      summary: Crea una nueva persona
      tags: [Persona]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PersonaRequest"
            example:
              nombre: "Gerardo Mayordomo"
              email: "gmayordo@ehcos.com"
              idJira: "gmayordo"
              perfilHorarioId: 1
              seniority: "LEAD"
              skills: "Java,Spring Boot,React"
              costeHora: 45.00
              fechaIncorporacion: "2020-01-15"
              sendNotifications: true
      responses:
        "201":
          description: Persona creada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonaResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/personas/{id}:
    get:
      operationId: obtenerPersona
      summary: Obtiene una persona por ID
      tags: [Persona]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Persona encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonaResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      operationId: actualizarPersona
      summary: Actualiza una persona
      tags: [Persona]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PersonaRequest"
      responses:
        "200":
          description: Persona actualizada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonaResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/personas/{id}/desactivar:
    patch:
      operationId: desactivarPersona
      summary: Desactiva una persona (soft delete)
      tags: [Persona]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Persona desactivada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PersonaResponse"
        "404":
          $ref: "#/components/responses/NotFound"

  # ═══════════════════════════════════════════════
  # SQUAD MEMBERS (DEDICACIÓN)
  # ═══════════════════════════════════════════════
  /api/v1/squads/{squadId}/miembros:
    get:
      operationId: listarMiembrosSquad
      summary: Lista miembros de un squad
      tags: [SquadMember]
      parameters:
        - name: squadId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID del squad
      responses:
        "200":
          description: Lista de miembros del squad
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SquadMemberResponse"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/personas/{personaId}/squads:
    get:
      operationId: listarSquadsDePersona
      summary: Lista squads a los que pertenece una persona
      tags: [SquadMember]
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID de la persona
      responses:
        "200":
          description: Lista de asignaciones de la persona
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/SquadMemberResponse"
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/squad-members:
    post:
      operationId: asignarPersonaASquad
      summary: Asigna una persona a un squad con rol y porcentaje
      tags: [SquadMember]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SquadMemberRequest"
            example:
              personaId: 1
              squadId: 1
              rol: "BACKEND"
              porcentaje: 100
              fechaInicio: "2026-02-01"
      responses:
        "201":
          description: Asignación creada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SquadMemberResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/squad-members/{id}:
    put:
      operationId: actualizarDedicacion
      summary: Modifica rol o porcentaje de dedicación
      tags: [SquadMember]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SquadMemberRequest"
      responses:
        "200":
          description: Dedicación actualizada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SquadMemberResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      operationId: eliminarDedicacion
      summary: Elimina asignación de persona a squad
      tags: [SquadMember]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "204":
          description: Asignación eliminada
        "404":
          $ref: "#/components/responses/NotFound"

  # ═══════════════════════════════════════════════
  # FESTIVOS
  # ═══════════════════════════════════════════════
  /api/v1/festivos:
    get:
      operationId: listarFestivos
      summary: Lista festivos con filtros opcionales
      tags: [Festivo]
      parameters:
        - name: anio
          in: query
          required: false
          schema:
            type: integer
          description: Filtrar por año
        - name: tipo
          in: query
          required: false
          schema:
            type: string
            enum: [NACIONAL, REGIONAL, LOCAL]
          description: Filtrar por tipo de festivo
      responses:
        "200":
          description: Lista de festivos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FestivoResponse"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      operationId: crearFestivo
      summary: Crea un nuevo festivo
      tags: [Festivo]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FestivoRequest"
      responses:
        "201":
          description: Festivo creado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FestivoResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/festivos/{id}:
    get:
      operationId: obtenerFestivo
      summary: Obtiene un festivo por ID
      tags: [Festivo]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Festivo encontrado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FestivoResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      operationId: actualizarFestivo
      summary: Actualiza un festivo
      tags: [Festivo]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/FestivoRequest"
      responses:
        "200":
          description: Festivo actualizado
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FestivoResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      operationId: eliminarFestivo
      summary: Elimina un festivo
      tags: [Festivo]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "204":
          description: Festivo eliminado
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/festivos/carga-masiva:
    post:
      operationId: cargarFestivosCsv
      summary: Carga masiva de festivos desde CSV
      description: |
        Procesa un archivo CSV con festivos. 
        Formato: fecha;descripcion;tipo;emails_personas (separados por |)
        Ejemplo: 2026-01-01;Año Nuevo;NACIONAL;persona1@ehcos.com|persona2@ehcos.com
      tags: [Festivo]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [file]
              properties:
                file:
                  type: string
                  format: binary
                  description: Archivo CSV con festivos
      responses:
        "200":
          description: Carga procesada (puede tener errores parciales)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FestivoCsvUploadResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/personas/{personaId}/festivos:
    get:
      operationId: listarFestivosPorPersona
      summary: Lista festivos asignados a una persona
      tags: [Festivo]
      parameters:
        - name: personaId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: fechaInicio
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: fechaFin
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Festivos de la persona
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/FestivoResponse"
        "404":
          $ref: "#/components/responses/NotFound"

  # ═══════════════════════════════════════════════
  # VACACIONES
  # ═══════════════════════════════════════════════
  /api/v1/vacaciones:
    get:
      operationId: listarVacaciones
      summary: Lista vacaciones con filtros opcionales
      tags: [Vacacion]
      parameters:
        - name: personaId
          in: query
          required: false
          schema:
            type: integer
            format: int64
        - name: squadId
          in: query
          required: false
          schema:
            type: integer
            format: int64
        - name: tipo
          in: query
          required: false
          schema:
            type: string
            enum: [VACACIONES, ASUNTOS_PROPIOS, LIBRE_DISPOSICION, PERMISO]
        - name: estado
          in: query
          required: false
          schema:
            type: string
            enum: [SOLICITADA, REGISTRADA]
        - name: fechaInicio
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: fechaFin
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Lista de vacaciones
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/VacacionResponse"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      operationId: crearVacacion
      summary: Crea una nueva vacación
      tags: [Vacacion]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VacacionRequest"
      responses:
        "201":
          description: Vacación creada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VacacionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/vacaciones/{id}:
    get:
      operationId: obtenerVacacion
      summary: Obtiene una vacación por ID
      tags: [Vacacion]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Vacación encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VacacionResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      operationId: actualizarVacacion
      summary: Actualiza una vacación
      tags: [Vacacion]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/VacacionRequest"
      responses:
        "200":
          description: Vacación actualizada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/VacacionResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      operationId: eliminarVacacion
      summary: Elimina una vacación
      tags: [Vacacion]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "204":
          description: Vacación eliminada
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/squads/{squadId}/vacaciones:
    get:
      operationId: listarVacionesPorSquad
      summary: Lista vacaciones de un squad en un período
      tags: [Vacacion]
      parameters:
        - name: squadId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: fechaInicio
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: fechaFin
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Vacaciones del squad
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/VacacionResponse"
        "404":
          $ref: "#/components/responses/NotFound"

  # ═══════════════════════════════════════════════
  # AUSENCIAS
  # ═══════════════════════════════════════════════
  /api/v1/ausencias:
    get:
      operationId: listarAusencias
      summary: Lista ausencias con filtros opcionales
      tags: [Ausencia]
      parameters:
        - name: personaId
          in: query
          required: false
          schema:
            type: integer
            format: int64
        - name: squadId
          in: query
          required: false
          schema:
            type: integer
            format: int64
        - name: tipo
          in: query
          required: false
          schema:
            type: string
            enum: [BAJA_MEDICA, EMERGENCIA, OTRO]
        - name: fechaInicio
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: fechaFin
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Lista de ausencias
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AusenciaResponse"
        "500":
          $ref: "#/components/responses/InternalError"
    post:
      operationId: crearAusencia
      summary: Crea una nueva ausencia
      tags: [Ausencia]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AusenciaRequest"
      responses:
        "201":
          description: Ausencia creada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AusenciaResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "500":
          $ref: "#/components/responses/InternalError"

  /api/v1/ausencias/{id}:
    get:
      operationId: obtenerAusencia
      summary: Obtiene una ausencia por ID
      tags: [Ausencia]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "200":
          description: Ausencia encontrada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AusenciaResponse"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      operationId: actualizarAusencia
      summary: Actualiza una ausencia
      tags: [Ausencia]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AusenciaRequest"
      responses:
        "200":
          description: Ausencia actualizada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AusenciaResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
    delete:
      operationId: eliminar Ausencia
      summary: Elimina una ausencia
      tags: [Ausencia]
      parameters:
        - $ref: "#/components/parameters/IdParam"
      responses:
        "204":
          description: Ausencia eliminada
        "404":
          $ref: "#/components/responses/NotFound"

  /api/v1/squads/{squadId}/ausencias:
    get:
      operationId: listarAusenciasPorSquad
      summary: Lista ausencias de un squad en un período
      tags: [Ausencia]
      parameters:
        - name: squadId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: fechaInicio
          in: query
          required: false
          schema:
            type: string
            format: date
        - name: fechaFin
          in: query
          required: false
          schema:
            type: string
            format: date
      responses:
        "200":
          description: Ausencias del squad
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/AusenciaResponse"
        "404":
          $ref: "#/components/responses/NotFound"

  # ═══════════════════════════════════════════════
  # CAPACIDAD
  # ═══════════════════════════════════════════════
  /api/v1/capacidad/squad/{squadId}:
    get:
      operationId: calcularCapacidadSquad
      summary: Calcula capacidad disponible del squad en un período
      description: |
        Calcula la capacidad disponible del squad considerando:
        - Horas del perfil horario de cada persona
        - Porcentaje de dedicación al squad
        - Festivos asignados a cada persona
        - Vacaciones en el período
        - Ausencias en el período
        - Fines de semana (0h)
      tags: [Capacidad]
      parameters:
        - name: squadId
          in: path
          required: true
          schema:
            type: integer
            format: int64
        - name: fechaInicio
          in: query
          required: true
          schema:
            type: string
            format: date
          description: Fecha inicio del período
        - name: fechaFin
          in: query
          required: true
          schema:
            type: string
            format: date
          description: Fecha fin del período
      responses:
        "200":
          description: Capacidad calculada
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CapacidadSquadResponse"
        "400":
          $ref: "#/components/responses/BadRequest"
        "404":
          $ref: "#/components/responses/NotFound"
        "500":
          $ref: "#/components/responses/InternalError"

# ═══════════════════════════════════════════════
# COMPONENTS
# ═══════════════════════════════════════════════
components:
  parameters:
    IdParam:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
      description: Identificador del recurso
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        default: 0
        minimum: 0
      description: Número de página (0-based)
    SizeParam:
      name: size
      in: query
      required: false
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100
      description: Tamaño de página
    SortParam:
      name: sort
      in: query
      required: false
      schema:
        type: string
      description: Campo de ordenación (campo,asc|desc)

  responses:
    BadRequest:
      description: Datos de entrada inválidos
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    NotFound:
      description: Recurso no encontrado
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"
    InternalError:
      description: Error interno del servidor
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ErrorResponse"

  schemas:
    # --- PERFIL HORARIO ---
    PerfilHorarioRequest:
      type: object
      required:
        [
          nombre,
          zonaHoraria,
          horasLunes,
          horasMartes,
          horasMiercoles,
          horasJueves,
          horasViernes,
        ]
      properties:
        nombre:
          type: string
          description: Nombre del perfil (ej. España, Chile)
          maxLength: 100
          example: "España"
        zonaHoraria:
          type: string
          description: Timezone IANA (ej. Europe/Madrid)
          maxLength: 50
          example: "Europe/Madrid"
        horasLunes:
          type: number
          format: double
          description: Horas laborables lunes
          example: 8.5
        horasMartes:
          type: number
          format: double
          description: Horas laborables martes
          example: 8.5
        horasMiercoles:
          type: number
          format: double
          description: Horas laborables miércoles
          example: 8.5
        horasJueves:
          type: number
          format: double
          description: Horas laborables jueves
          example: 8.5
        horasViernes:
          type: number
          format: double
          description: Horas laborables viernes
          example: 7.0

    PerfilHorarioResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        nombre:
          type: string
        zonaHoraria:
          type: string
        horasLunes:
          type: number
          format: double
        horasMartes:
          type: number
          format: double
        horasMiercoles:
          type: number
          format: double
        horasJueves:
          type: number
          format: double
        horasViernes:
          type: number
          format: double
        totalSemanal:
          type: number
          format: double
          description: Total calculado (sum L-V)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # --- SQUAD ---
    SquadRequest:
      type: object
      required: [nombre]
      properties:
        nombre:
          type: string
          description: Nombre del squad
          maxLength: 100
          example: "red"
        descripcion:
          type: string
          description: Descripción del squad
          example: "Squad Red"
        idSquadCorrJira:
          type: string
          description: ID del board de correctivos en Jira
          maxLength: 100
          example: "CORR-RED"
        idSquadEvolJira:
          type: string
          description: ID del board de evolutivos en Jira
          maxLength: 100
          example: "EVOL-RED"

    SquadResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        nombre:
          type: string
        descripcion:
          type: string
        estado:
          type: string
          enum: [ACTIVO, INACTIVO]
        idSquadCorrJira:
          type: string
        idSquadEvolJira:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # --- PERSONA ---
    PersonaRequest:
      type: object
      required: [nombre, email, perfilHorarioId]
      properties:
        nombre:
          type: string
          description: Nombre completo
          maxLength: 200
          example: "Gerardo Mayordomo"
        email:
          type: string
          format: email
          description: Email corporativo (único)
          maxLength: 200
          example: "gmayordo@ehcos.com"
        idJira:
          type: string
          description: Usuario Jira
          maxLength: 100
          example: "gmayordo"
        perfilHorarioId:
          type: integer
          format: int64
          description: ID del perfil de horario asignado
        seniority:
          type: string
          enum: [JUNIOR, MID, SENIOR, LEAD]
          description: Nivel de seniority
        skills:
          type: string
          description: Skills separadas por coma
          example: "Java,Spring Boot,React"
        costeHora:
          type: number
          format: double
          description: Coste por hora (opcional)
        fechaIncorporacion:
          type: string
          format: date
          description: Fecha de incorporación
        sendNotifications:
          type: boolean
          description: Flag para envío de notificaciones
          default: true

    PersonaResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        nombre:
          type: string
        email:
          type: string
        idJira:
          type: string
        perfilHorarioId:
          type: integer
          format: int64
        perfilHorarioNombre:
          type: string
          description: Nombre del perfil de horario
        seniority:
          type: string
          enum: [JUNIOR, MID, SENIOR, LEAD]
        skills:
          type: string
        costeHora:
          type: number
          format: double
        activo:
          type: boolean
        fechaIncorporacion:
          type: string
          format: date
        sendNotifications:
          type: boolean
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PagePersonaResponse:
      type: object
      description: Respuesta paginada de personas
      properties:
        content:
          type: array
          items:
            $ref: "#/components/schemas/PersonaResponse"
        totalElements:
          type: integer
          format: int64
        totalPages:
          type: integer
        number:
          type: integer
          description: Número de página actual (0-based)
        size:
          type: integer
          description: Tamaño de página

    # --- SQUAD MEMBER ---
    SquadMemberRequest:
      type: object
      required: [personaId, squadId, rol, porcentaje, fechaInicio]
      properties:
        personaId:
          type: integer
          format: int64
          description: ID de la persona
        squadId:
          type: integer
          format: int64
          description: ID del squad
        rol:
          type: string
          enum:
            [
              LIDER_TECNICO,
              LIDER_FUNCIONAL,
              FRONTEND,
              BACKEND,
              QA,
              SCRUM_MASTER,
            ]
          description: Rol en el squad
        porcentaje:
          type: integer
          minimum: 0
          maximum: 100
          description: Porcentaje de dedicación al squad
          example: 100
        fechaInicio:
          type: string
          format: date
          description: Fecha inicio de la asignación
        fechaFin:
          type: string
          format: date
          description: Fecha fin (null = indefinido)

    SquadMemberResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        personaId:
          type: integer
          format: int64
        personaNombre:
          type: string
          description: Nombre de la persona
        squadId:
          type: integer
          format: int64
        squadNombre:
          type: string
          description: Nombre del squad
        rol:
          type: string
          enum:
            [
              LIDER_TECNICO,
              LIDER_FUNCIONAL,
              FRONTEND,
              BACKEND,
              QA,
              SCRUM_MASTER,
            ]
        porcentaje:
          type: integer
        fechaInicio:
          type: string
          format: date
        fechaFin:
          type: string
          format: date
        capacidadDiariaLunes:
          type: number
          format: double
          description: Capacidad diaria calculada (horas_perfil × porcentaje / 100)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # --- FESTIVO ---
    FestivoRequest:
      type: object
      required: [fecha, descripcion, tipo, personaIds]
      properties:
        fecha:
          type: string
          format: date
          description: Fecha del festivo
          example: "2026-01-01"
        descripcion:
          type: string
          maxLength: 200
          description: Descripción del festivo
          example: "Año Nuevo"
        tipo:
          type: string
          enum: [NACIONAL, REGIONAL, LOCAL]
          description: Tipo de festivo
        personaIds:
          type: array
          items:
            type: integer
            format: int64
          description: IDs de personas a las que aplica el festivo
          minItems: 1

    FestivoResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        fecha:
          type: string
          format: date
        descripcion:
          type: string
        tipo:
          type: string
          enum: [NACIONAL, REGIONAL, LOCAL]
        personas:
          type: array
          items:
            $ref: "#/components/schemas/PersonaBasicInfo"
          description: Personas a las que aplica
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    PersonaBasicInfo:
      type: object
      description: Información básica de una persona (para referencias)
      properties:
        id:
          type: integer
          format: int64
        nombre:
          type: string
        email:
          type: string

    FestivoCsvUploadResponse:
      type: object
      description: Resumen de carga masiva de festivos
      properties:
        totalProcesados:
          type: integer
          description: Total de filas procesadas
        exitosos:
          type: integer
          description: Festivos creados exitosamente
        errores:
          type: integer
          description: Número de errores
        detalleErrores:
          type: array
          items:
            $ref: "#/components/schemas/FestivoCsvError"

    FestivoCsvError:
      type: object
      properties:
        fila:
          type: integer
          description: Número de fila con error (1-based)
        mensaje:
          type: string
          description: Descripción del error

    # --- VACACION ---
    VacacionRequest:
      type: object
      required: [personaId, fechaInicio, fechaFin, tipo, estado]
      properties:
        personaId:
          type: integer
          format: int64
          description: ID de la persona
        fechaInicio:
          type: string
          format: date
          description: Fecha inicio de vacaciones
          example: "2026-03-01"
        fechaFin:
          type: string
          format: date
          description: Fecha fin de vacaciones (inclusive)
          example: "2026-03-05"
        tipo:
          type: string
          enum: [VACACIONES, ASUNTOS_PROPIOS, LIBRE_DISPOSICION, PERMISO]
          description: Tipo de vacación
        estado:
          type: string
          enum: [SOLICITADA, REGISTRADA]
          description: Estado actual
        comentario:
          type: string
          maxLength: 500
          description: Comentario adicional

    VacacionResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        personaId:
          type: integer
          format: int64
        personaNombre:
          type: string
          description: Nombre de la persona
        fechaInicio:
          type: string
          format: date
        fechaFin:
          type: string
          format: date
        diasLaborables:
          type: integer
          description: Días laborables (excluye fines de semana)
        tipo:
          type: string
          enum: [VACACIONES, ASUNTOS_PROPIOS, LIBRE_DISPOSICION, PERMISO]
        estado:
          type: string
          enum: [SOLICITADA, REGISTRADA]
        comentario:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # --- AUSENCIA ---
    AusenciaRequest:
      type: object
      required: [personaId, fechaInicio, tipo]
      properties:
        personaId:
          type: integer
          format: int64
          description: ID de la persona
        fechaInicio:
          type: string
          format: date
          description: Fecha inicio de ausencia
          example: "2026-04-10"
        fechaFin:
          type: string
          format: date
          description: Fecha fin (null = duración desconocida)
          nullable: true
        tipo:
          type: string
          enum: [BAJA_MEDICA, EMERGENCIA, OTRO]
          description: Tipo de ausencia
        comentario:
          type: string
          maxLength: 500
          description: Comentario adicional

    AusenciaResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
        personaId:
          type: integer
          format: int64
        personaNombre:
          type: string
          description: Nombre de la persona
        fechaInicio:
          type: string
          format: date
        fechaFin:
          type: string
          format: date
          nullable: true
        tipo:
          type: string
          enum: [BAJA_MEDICA, EMERGENCIA, OTRO]
        comentario:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    # --- CAPACIDAD ---
    CapacidadSquadResponse:
      type: object
      description: Capacidad disponible de un squad
      properties:
        squadId:
          type: integer
          format: int64
        squadNombre:
          type: string
        fechaInicio:
          type: string
          format: date
        fechaFin:
          type: string
          format: date
        horasTotales:
          type: number
          format: double
          description: Horas totales disponibles del squad
        diasLaborables:
          type: integer
          description: Días laborables en el período
        personas:
          type: array
          items:
            $ref: "#/components/schemas/CapacidadPersonaResponse"
          description: Capacidad por persona

    CapacidadPersonaResponse:
      type: object
      description: Capacidad disponible de una persona en un período
      properties:
        personaId:
          type: integer
          format: int64
        personaNombre:
          type: string
        porcentajeDedicacion:
          type: integer
          description: Porcentaje de dedicación al squad
        horasDisponibles:
          type: number
          format: double
          description: Horas reales disponibles (con reducciones)
        horasTeoricasMaximas:
          type: number
          format: double
          description: Horas máximas teóricas (sin reducciones)
        diasDisponibles:
          type: integer
          description: Días con horas disponibles
        diasReducidos:
          type: integer
          description: Días con festivos/vacaciones/ausencias
        porcentajeCapacidad:
          type: number
          format: double
          description: "% de capacidad (horasDisponibles / horasTeoricasMaximas)"
        detalles:
          type: array
          items:
            $ref: "#/components/schemas/CapacidadDiaResponse"
          description: Detalle día a día

    CapacidadDiaResponse:
      type: object
      description: Capacidad de un día específico
      properties:
        fecha:
          type: string
          format: date
        diaSemana:
          type: string
          description: Nombre del día (LUNES, MARTES, etc.)
        horasDisponibles:
          type: number
          format: double
          description: Horas disponibles ese día
        horasTeoricas:
          type: number
          format: double
          description: Horas del perfil horario (sin reducciones)
        motivoReduccion:
          type: string
          enum: [FESTIVO, VACACION, AUSENCIA, FIN_SEMANA]
          nullable: true
          description: Motivo si hay reducción a 0 horas

    # --- ERROR ---
    ErrorResponse:
      type: object
      properties:
        code:
          type: string
          example: "NOT_FOUND"
        message:
          type: string
          example: "Recurso no encontrado"
        details:
          type: array
          items:
            type: string
        timestamp:
          type: string
          format: date-time
